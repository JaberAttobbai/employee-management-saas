// Ù…Ù„Ù ØªØ¹Ø±ÙŠÙ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - Turso (LibSQL) for Production
// ÙŠØ¯Ø¹Ù… SQLite Ù…Ø­Ù„ÙŠØ§Ù‹ Ùˆ Turso ÙÙŠ Production

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ============================================
// Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø´Ø±ÙƒØ§Øª (Tenants)
// ============================================
model Tenant {
  id            String   @id @default(uuid())
  name          String   // Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©
  domain        String   @unique  // Ù†Ø·Ø§Ù‚ ÙØ±Ø¹ÙŠ
  size          String   @default("SMALL")  // SMALL, MEDIUM, LARGE
  industry      String?  // Ø§Ù„Ù…Ø¬Ø§Ù„
  logo          String?  // Ø±Ø§Ø¨Ø· Ø§Ù„Ø´Ø¹Ø§Ø±
  status        String   @default("TRIAL")  // TRIAL, ACTIVE, SUSPENDED
  trialEndsAt   DateTime?  // ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØªØ¬Ø±Ø¨Ø©
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  users         User[]
  employees     Employee[]
  attendance    Attendance[]
  leaves        Leave[]
  leaveBalances LeaveBalance[]
  settings      Settings?

  @@map("tenants")
}

// ============================================
// Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (Users)
// ============================================
model User {
  id            String   @id @default(uuid())
  tenantId      String   // Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„ØªØ§Ø¨Ø¹ Ù„Ù‡Ø§
  email         String   // Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
  password      String   // ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (Ù…Ø´ÙØ±Ø©)
  role          String   @default("EMPLOYEE")  // ADMIN, HR, EMPLOYEE
  status        String   @default("ACTIVE")  // ACTIVE, INACTIVE
  emailVerified Boolean  @default(false)
  // ğŸ” Security: Ù‡Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù…Ø¤Ù‚ØªØ©ØŸ
  // Ù…Ù„Ø§Ø­Ø¸Ø©: ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØŒ Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ Ù„Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙÙ‚Ø·
  // Ù„Ø§ ÙŠÙØ³ØªØ®Ø¯Ù… Ù„Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù„Ù‰ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
  // Ø§Ù„Ù…ÙˆØ¸Ù ÙŠÙ…ÙƒÙ†Ù‡ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù…Ù† Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯Ù‡ Ø§Ø®ØªÙŠØ§Ø±ÙŠØ§Ù‹
  mustChangePassword Boolean @default(false)
  lastLoginAt   DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  tenant        Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  employee      Employee?  // Ù…ÙˆØ¸Ù Ù…Ø±ØªØ¨Ø· (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
  reviewedLeaves Leave[] @relation("ReviewedBy")

  // ÙÙ‡Ø§Ø±Ø³ Ù„Ù„Ø£Ø¯Ø§Ø¡
  @@unique([tenantId, email])  // Ø¨Ø±ÙŠØ¯ ÙØ±ÙŠØ¯ Ø¯Ø§Ø®Ù„ ÙƒÙ„ Ø´Ø±ÙƒØ©
  @@index([tenantId])
  @@index([email])
  @@map("users")
}

// ============================================
// Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† (Employees)
// ============================================
model Employee {
  id             String   @id @default(uuid())
  tenantId       String   // Ø§Ù„Ø´Ø±ÙƒØ©
  userId         String?  @unique  // Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø±ØªØ¨Ø· (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
  employeeNumber String   // Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù (ÙØ±ÙŠØ¯ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø´Ø±ÙƒØ©)
  firstName      String   // Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„
  lastName       String   // Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©
  email          String   // Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
  phone          String   // Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
  birthDate      DateTime?  // ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯
  gender         String?  // MALE, FEMALE, OTHER
  department     String   // Ø§Ù„Ù‚Ø³Ù…
  position       String   // Ø§Ù„Ù…Ù†ØµØ¨
  hireDate       DateTime // ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†
  salary         Float?   // Ø§Ù„Ø±Ø§ØªØ¨
  avatar         String?  // ØµÙˆØ±Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
  status         String   @default("ACTIVE")  // ACTIVE, INACTIVE
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  tenant         Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user           User?    @relation(fields: [userId], references: [id])
  attendance     Attendance[]
  leaves         Leave[]
  leaveBalance   LeaveBalance?

  // ÙÙ‡Ø§Ø±Ø³
  @@unique([tenantId, employeeNumber])
  @@index([tenantId])
  @@index([userId])
  @@map("employees")
}

// ============================================
// Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± (Attendance)
// ============================================
model Attendance {
  id         String   @id @default(uuid())
  tenantId   String   // Ø§Ù„Ø´Ø±ÙƒØ©
  employeeId String   // Ø§Ù„Ù…ÙˆØ¸Ù
  date       DateTime // Ø§Ù„ØªØ§Ø±ÙŠØ® (ÙÙ‚Ø· Ø§Ù„ÙŠÙˆÙ…)
  checkIn    DateTime // ÙˆÙ‚Øª Ø§Ù„Ø¯Ø®ÙˆÙ„
  checkOut   DateTime?  // ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬
  totalHours Float?   // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª
  status     String   @default("PRESENT")  // PRESENT, LATE, HALF_DAY, ABSENT
  notes      String?  // Ù…Ù„Ø§Ø­Ø¸Ø§Øª
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  tenant     Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  // ÙÙ‡Ø§Ø±Ø³ - Ù…ÙˆØ¸Ù ÙˆØ§Ø­Ø¯ = Ø³Ø¬Ù„ ÙˆØ§Ø­Ø¯ Ù„ÙƒÙ„ ÙŠÙˆÙ…
  @@unique([tenantId, employeeId, date])
  @@index([tenantId, date])
  @@map("attendance")
}

// ============================================
// Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª (Leaves)
// ============================================
model Leave {
  id              String   @id @default(uuid())
  tenantId        String   // Ø§Ù„Ø´Ø±ÙƒØ©
  employeeId      String   // Ø§Ù„Ù…ÙˆØ¸Ù
  type            String   // ANNUAL, SICK, EMERGENCY
  startDate       DateTime // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
  endDate         DateTime // ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
  days            Int      // Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…
  reason          String?  // Ø§Ù„Ø³Ø¨Ø¨
  status          String   @default("PENDING")  // PENDING, APPROVED, REJECTED
  reviewedBy      String?  // Ù…Ù† Ø±Ø§Ø¬Ø¹Ù‡
  reviewedAt      DateTime?  // ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
  rejectionReason String?  // Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  tenant          Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  employee        Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  reviewer        User?    @relation("ReviewedBy", fields: [reviewedBy], references: [id])

  // ÙÙ‡Ø§Ø±Ø³
  @@index([tenantId, employeeId])
  @@index([tenantId, status])
  @@map("leaves")
}

// ============================================
// Ø¬Ø¯ÙˆÙ„ Ø£Ø±ØµØ¯Ø© Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª (Leave Balances)
// ============================================
model LeaveBalance {
  id               String   @id @default(uuid())
  tenantId         String   // Ø§Ù„Ø´Ø±ÙƒØ©
  employeeId       String   @unique  // Ø§Ù„Ù…ÙˆØ¸Ù (ÙˆØ§Ø­Ø¯ Ù„ÙˆØ§Ø­Ø¯)
  year             Int      // Ø§Ù„Ø³Ù†Ø©
  annualTotal      Int      // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ù†ÙˆÙŠØ©
  annualUsed       Int      @default(0)  // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
  annualRemaining  Int      // Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
  sickTotal        Int      // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±Ø¶ÙŠØ©
  sickUsed         Int      @default(0)
  sickRemaining    Int      // Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  tenant           Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  employee         Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  // ÙÙ‡Ø§Ø±Ø³
  @@unique([tenantId, employeeId, year])
  @@map("leave_balances")
}

// ============================================
// Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Settings)
// ============================================
model Settings {
  id                    String   @id @default(uuid())
  tenantId              String   @unique  // Ø´Ø±ÙƒØ© ÙˆØ§Ø­Ø¯Ø© = Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ø­Ø¯Ø©
  workStartTime         String   @default("08:00")  // ÙˆÙ‚Øª Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¹Ù…Ù„
  workEndTime           String   @default("17:00")  // ÙˆÙ‚Øª Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¹Ù…Ù„
  lateThresholdMinutes  Int      @default(15)  // Ø§Ù„ØªØ£Ø®ÙŠØ± Ø§Ù„Ù…Ø³Ù…ÙˆØ­
  workDays              String   @default("[\"SUNDAY\",\"MONDAY\",\"TUESDAY\",\"WEDNESDAY\",\"THURSDAY\"]")  // JSON
  annualLeaveDays       Int      @default(21)  // Ø£ÙŠØ§Ù… Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ©
  sickLeaveDays         Int      @default(10)  // Ø£ÙŠØ§Ù… Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ù…Ø±Ø¶ÙŠØ©
  holidays              String   @default("[]")  // JSON [{date, name}]
  currency              String   @default("SAR")  // Ø§Ù„Ø¹Ù…Ù„Ø©
  timezone              String   @default("Asia/Riyadh")  // Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  tenant                Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("settings")
}
